#include "12864_driver.h"
#include "gpio.h"
#include "delay.h"
#include "FreeRTOS.h"
#include "task.h"


#define _CS			PB0
#define _SID		PA6
#define _RST		PB12
#define _CLK		PB14

#define MACRO_X1    0x80
#define MACRO_X2    0x88
#define MACRO_Y     0x80
#define MACRO_COMM  0
#define MACRO_DAT   1

uint8_t tab1[]={
"本系列中文模块内"
"任意位置反白显示"
"置二级字库，可在"
"使用更方便更灵活"
};

uint8_t tab31[]={
"金鹏科技有限公司"
"Golden Palm TECH"
};

uint8_t tab32[]={
/*--  调入了一幅图像：F:\梁\画图\HOCO12832.bmp  --*/
/*--  宽度x高度=128x32  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x1E,0x00,0x00,0x00,0x00,0x00,0x07,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x7F,0x80,0x00,0x00,0x00,0x00,0x18,0x0C,0x00,0x00,0x01,0x00,0x00,0x00,0x00,
0x01,0xFF,0x80,0x00,0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x13,0x10,0x03,0xFE,0x00,
0x03,0xFF,0xC0,0x00,0x00,0x00,0x00,0x58,0x00,0x00,0x00,0x3F,0x30,0x1F,0xFF,0xC0,
0x03,0xFF,0xE0,0x00,0x00,0x00,0x00,0x8C,0x03,0xF0,0x00,0x7F,0xE0,0x7C,0x01,0xE0,
0x03,0xFF,0xF0,0x00,0x00,0x00,0x01,0x36,0x06,0xC0,0x00,0x5F,0xC0,0xFF,0xFC,0x60,
0x01,0xFF,0xF0,0x00,0x00,0x00,0x02,0x1B,0x0F,0x80,0x00,0xFF,0x01,0xFE,0x0F,0x30,
0x00,0xEF,0xF0,0x00,0x00,0x00,0x02,0x6D,0x9F,0x00,0x00,0x3E,0x03,0xFF,0xF1,0x90,
0x00,0xFF,0xF8,0x00,0x00,0x00,0x04,0x36,0xFE,0x00,0x01,0xFF,0x07,0xFF,0xFC,0x90,
0x00,0xEF,0xFF,0xFF,0x80,0x00,0x04,0xDB,0x7E,0x00,0x03,0xFF,0x87,0xFF,0xFC,0xD0,
0x00,0x0F,0xFF,0xFF,0xC0,0x00,0x04,0x6D,0xFC,0x00,0x07,0xFF,0x8F,0xFF,0xFE,0x50,
0x00,0x0F,0xFF,0xFF,0xE0,0x00,0x04,0x36,0xFC,0x10,0x07,0xFF,0x8F,0xFF,0xFE,0x90,
0x00,0x0F,0xFF,0xFF,0xE0,0x00,0x04,0x1B,0xF8,0x10,0x07,0xFF,0xCF,0xFF,0xFE,0x80,
0x00,0x0F,0xFF,0xFF,0xF0,0x00,0x04,0x0F,0xF8,0x10,0x07,0xFF,0xFF,0xFF,0xFA,0x00,
0x00,0x07,0xFF,0xFF,0xF0,0x00,0x04,0x07,0xF0,0x10,0x07,0xFF,0xFF,0xFF,0xFA,0x00,
0x00,0xFF,0xFF,0xFF,0xF8,0x00,0x02,0x03,0xF0,0x20,0x07,0xFF,0xFF,0xFF,0xBA,0x00,
0x00,0xFD,0xFF,0xFF,0xFC,0x00,0x02,0x03,0xF0,0x20,0x03,0xFF,0xFF,0xDF,0xB8,0x00,
0x00,0xC1,0xC0,0x3F,0xFC,0x00,0x01,0x01,0xE0,0x40,0x00,0xFF,0xFF,0xDF,0xB0,0x00,
0x00,0x81,0xC0,0x3F,0xCE,0x00,0x00,0x81,0xE0,0x80,0x00,0x7F,0xFF,0xDF,0xA0,0x00,
0x00,0x81,0x80,0x1D,0xCF,0x00,0x00,0x41,0xE1,0x00,0x00,0x3F,0xFF,0x9B,0x00,0x00,
0x01,0x83,0x80,0x1F,0xC7,0x80,0x00,0x21,0xE2,0x00,0x00,0x1F,0xFD,0xB6,0x00,0x00,
0x01,0xC3,0x00,0x0E,0xE6,0x80,0x00,0x19,0xEC,0x00,0x00,0x07,0xFE,0x20,0x00,0x00,
0x00,0xC3,0x00,0x07,0x67,0x40,0x00,0x07,0xF0,0x00,0x00,0x03,0x3E,0x00,0x00,0x00,
0x00,0x02,0x00,0x03,0xE7,0xA0,0x00,0x00,0x00,0x00,0x00,0x02,0x8E,0x00,0x00,0x00,
0x00,0x06,0x00,0x03,0x83,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x03,0x00,0x00,0x00,
0x00,0x06,0x00,0x07,0x03,0x00,0x77,0x46,0x74,0x24,0x80,0x06,0x04,0x00,0x00,0x00,
0x00,0x1C,0x00,0x06,0x00,0x00,0x55,0x45,0x54,0x57,0x80,0x00,0x00,0x00,0x00,0x00,
0x00,0x1C,0x00,0x0E,0x00,0x00,0x45,0x45,0x74,0x57,0x80,0x08,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x1C,0x00,0x00,0x55,0x45,0x44,0x74,0x80,0xF0,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x38,0x00,0x00,0x77,0x76,0x47,0x54,0x80,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

uint8_t tab5[]={
/*--  调入了一幅图像：F:\梁\画图\COCK.bmp  --*/
/*--  宽度x高度=128x64  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x80,0x00,0x0F,0xFF,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x0C,0x43,0x01,0x80,0x00,0x7F,0xFF,0xF0,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x19,0xFF,0x07,0x00,0x07,0xFF,0xFF,0xFE,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x01,0x3F,0xFC,0x1E,0x00,0x1F,0xFF,0xFF,0xFF,0x80,0x00,0x00,0x00,
0x00,0x00,0x00,0x01,0xBF,0xFF,0xFC,0x00,0x7F,0xFC,0x00,0x7F,0xC0,0x00,0x00,0x00,
0x00,0x00,0x00,0x01,0xFF,0xFF,0xF0,0x00,0xFF,0xC0,0x00,0x0F,0xE0,0x00,0x00,0x00,
0x00,0x00,0x00,0x01,0xFF,0xFF,0xE0,0x03,0xFF,0xFF,0xFC,0x01,0xF0,0x00,0x00,0x00,
0x00,0x00,0x00,0x01,0xDF,0xFF,0xC0,0x07,0xFF,0xFF,0xFF,0x80,0xF0,0x00,0x00,0x00,
0x00,0x00,0x00,0x03,0xFF,0xFF,0x00,0x0F,0xFF,0xFF,0xFF,0xE0,0x38,0x00,0x00,0x00,
0x00,0x00,0x00,0x07,0xFF,0xF8,0x00,0x1F,0xFF,0xF0,0x03,0xF8,0x38,0x00,0x00,0x00,
0x00,0x00,0x00,0x07,0xFF,0xE0,0x00,0x3F,0xFF,0xFF,0xC0,0x7C,0x18,0x00,0x00,0x00,
0x00,0x00,0x00,0x04,0x7F,0xF0,0x00,0x3F,0xFF,0xFF,0xF8,0x1E,0x08,0x00,0x00,0x00,
0x00,0x00,0x00,0x01,0xFF,0xF8,0x00,0x7F,0xFF,0xFF,0xFE,0x0F,0x08,0x00,0x00,0x00,
0x00,0x00,0x00,0x0F,0xFF,0xFC,0x00,0xFF,0xFF,0xFF,0xFF,0x87,0x08,0x00,0x00,0x00,
0x00,0x00,0x00,0x1F,0xFF,0xFE,0x00,0xFF,0xFF,0xFF,0xFF,0x83,0x88,0x00,0x00,0x00,
0x00,0x00,0x00,0x3F,0xFF,0xFE,0x01,0xFF,0xFF,0xFF,0xFF,0xC3,0x88,0x00,0x00,0x00,
0x00,0x00,0x00,0x7F,0xFF,0xFE,0x01,0xFF,0xFF,0xFF,0xFF,0xE1,0x88,0x00,0x00,0x00,
0x00,0x00,0x00,0xFF,0xFF,0xFE,0x03,0xFF,0xFF,0xFF,0xFF,0xE1,0x88,0x00,0x00,0x00,
0x00,0x00,0x01,0xFF,0xFF,0xFE,0x03,0xFF,0xFF,0xFF,0xFF,0xF1,0x88,0x00,0x00,0x00,
0x00,0x00,0x01,0xFF,0xFF,0xFE,0x03,0xFF,0xFF,0xFF,0xFF,0xF3,0x08,0x00,0x00,0x00,
0x00,0x00,0x01,0xFF,0xFF,0xFF,0x07,0xFF,0xFF,0xFF,0xFF,0xF2,0x10,0x00,0x00,0x00,
0x00,0x00,0x01,0xFF,0xFF,0xFF,0x8F,0xFF,0xFF,0xFF,0xFF,0xF0,0x20,0x00,0x00,0x00,
0x00,0x00,0x01,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF0,0x00,0x00,0x00,0x00,
0x00,0x00,0x01,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x70,0x00,0x00,0x00,0x00,
0x00,0x00,0x01,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFE,0xFF,0x70,0x00,0x00,0x00,0x00,
0x00,0x00,0x01,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFE,0xFF,0x70,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x7F,0xFF,0x7F,0x20,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xBF,0xFF,0x7F,0x20,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x7F,0xFF,0xFF,0xFF,0xFF,0xDF,0xFF,0x7E,0x20,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x3F,0xFF,0xFF,0xFF,0xFF,0xDF,0xFF,0x3E,0x40,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x1F,0xFF,0xFF,0xFF,0xFF,0xCF,0xFF,0x3C,0x40,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x0F,0xFF,0xFF,0xFF,0xFF,0xCF,0xFE,0x38,0x40,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x07,0xFF,0xFF,0xFF,0xFF,0x8F,0xFE,0x38,0x40,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x01,0xFF,0xFF,0xFF,0xFF,0x8F,0xFE,0x30,0x40,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x1F,0x7C,0x20,0x40,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x7F,0xFF,0xFF,0xFE,0x1E,0x78,0x00,0x40,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x3F,0xFF,0xFF,0xFE,0x1E,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x1F,0xFF,0xFF,0xDA,0x3C,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x07,0xFF,0xFF,0xF2,0x30,0x80,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x01,0xFF,0xFF,0xF1,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0xFE,0x7F,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x7C,0x3F,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x78,0x1F,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x72,0x07,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x70,0x00,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x60,0x00,0x78,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x60,0x00,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0xC0,0x03,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x01,0x40,0x04,0xD8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x01,0x00,0x01,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x02,0x0C,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x02,0x40,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x0C,0x48,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x38,0x41,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x0F,0xE2,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};



/*
@说明：读写
*/
static void wr_lcd(uint8_t dat_comm, uint8_t content)
{
	uint8_t a,i,j;
//	delay_us(100);
	delay_us(1); 
	a = content;
	_CS = 1;
	delay_us(1); 
	_CLK = 0;
	delay_us(1); 	
	_SID = 1;
	delay_us(1); 
	
	for(i = 0; i < 5; i++)
	{
		_CLK = 1;
		delay_us(1); 
		_CLK = 0;
		delay_us(1);  
	}
	
	_SID = 0;
	delay_us(1); 
	_CLK = 1;
	delay_us(1); 
	_CLK = 0;
	delay_us(1);
	
	if(dat_comm)
		_SID = 1;   //data
	else
		_SID = 0;   //command
	
	_CLK = 1;
	delay_us(1); 
	_CLK = 0;
	delay_us(1); 
	_SID = 0;
	delay_us(1);  
	_CLK = 1;
	delay_us(1);  
	_CLK = 0;
	delay_us(1);
	
	for(j = 0; j < 2; j++)
	{
		for(i = 0; i < 4; i++)
		{
		  if((a&0x80)==0x80)
		  	_SID = 1;
		  else 
				_SID = 0;
			
		  delay_us(1);  
		  a = a<<1;
		  _CLK = 1;
		  delay_us(1);  
		  _CLK = 0;
			delay_us(1); 
		}
		_SID = 0;
		delay_us(1); 
		
		for(i = 0;i < 4; i++)
		{
		  _CLK = 1;
		  delay_us(1);  
		  _CLK = 0;
		  delay_us(1);  
		}
	}
}

/*--------------清DDRAM------------------*/
void lcd_clear (void)
{
  wr_lcd (MACRO_COMM,0x30);
  wr_lcd (MACRO_COMM,0x01);
	vTaskDelay(5);
}

/*---------------显示汉字或字符----------------*/
void chn_disp (uint8_t *chn)
{
	uint8_t i,j;
  wr_lcd (MACRO_COMM, 0x30);
  wr_lcd (MACRO_COMM, 0x80);
  for (j = 0; j < 4; j++)
  {
    for(i = 0; i < 16; i++)
			wr_lcd (MACRO_DAT, chn[j*16+i]);
  }
}

/*-----------上半屏显示汉字或字符------------*/
void chn_disp1 (uint8_t *chn)
{
	uint8_t i,j;
  wr_lcd (MACRO_COMM,0x30);
  wr_lcd (MACRO_COMM,0x80);
  j=0;
  for (i=0;i<16;i++)
  wr_lcd (MACRO_DAT,chn[j*16+i]);
  wr_lcd (MACRO_COMM,0x90);
  j=1;
  for (i=0;i<16;i++)
  wr_lcd (MACRO_DAT,chn[j*16+i]);
}

/*----------------显示图形-----------------*/
void img_disp (uint8_t *img)
{
	uint8_t i,j;
	for(j=0;j<32;j++)
	{
		for(i=0;i<8;i++)
		{
			wr_lcd (MACRO_COMM,0x34);
			
			wr_lcd (MACRO_COMM,MACRO_Y+j);
			wr_lcd (MACRO_COMM,MACRO_X1+i);
			wr_lcd (MACRO_COMM,0x30);
			wr_lcd (MACRO_DAT,img[j*16+i*2]);
			wr_lcd (MACRO_DAT,img[j*16+i*2+1]);
		}
	}
	for(j=32;j<64;j++)
	{
		for(i=0;i<8;i++)
		{
			wr_lcd (MACRO_COMM,0x34);
			wr_lcd (MACRO_COMM,MACRO_Y+j-32);
			wr_lcd (MACRO_COMM,MACRO_X2+i);
			wr_lcd (MACRO_COMM,0x30);
			wr_lcd (MACRO_DAT,img[j*16+i*2]);
			wr_lcd (MACRO_DAT,img[j*16+i*2+1]);
		}
	}
	wr_lcd (MACRO_COMM,0x36);
}

/*-------------下半屏显示图形--------------*/
void img_disp1 (uint8_t *img)
{
	uint8_t i,j;
  for(j=0;j<32;j++)
  {
    for(i=0;i<8;i++)
    {
      wr_lcd (MACRO_COMM,0x34);
      wr_lcd (MACRO_COMM,MACRO_Y+j);
      wr_lcd (MACRO_COMM,MACRO_X2+i);
      wr_lcd (MACRO_COMM,0x30);
      wr_lcd (MACRO_DAT,img[j*16+i*2]);
      wr_lcd (MACRO_DAT,img[j*16+i*2+1]);
    }
  }
  wr_lcd (MACRO_COMM,0x36);
}

/*--------------显示点阵----------------*/
void lat_disp (uint8_t data1, uint8_t data2)
{
  uint8_t i,j,k,x;
  x=MACRO_X1;
  for(k=0;k<2;k++)
  {
    for(j=0;j<16;j++)
    {
      for(i=0;i<8;i++)
      {
        wr_lcd (MACRO_COMM,0x34);
        wr_lcd (MACRO_COMM,MACRO_Y+j*2);
        wr_lcd (MACRO_COMM,x+i);
        wr_lcd (MACRO_COMM,0x30);
        wr_lcd (MACRO_DAT,data1);
        wr_lcd (MACRO_DAT,data1);
      }
      for(i=0;i<8;i++)
      {
        wr_lcd (MACRO_COMM,0x34);
        wr_lcd (MACRO_COMM,MACRO_Y+j*2+1);
        wr_lcd (MACRO_COMM,x+i);
        wr_lcd (MACRO_COMM,0x30);
        wr_lcd (MACRO_DAT,data2);
        wr_lcd (MACRO_DAT,data2);
      }
    }
    x=MACRO_X2;
  }
  wr_lcd (MACRO_COMM,0x36);
}

/*-----------------------------------------------*/
//当data1=0xff,data2=0xff时,在x0,y0处反白显示16xl*yl.
void con_disp (uint8_t data1,uint8_t data2,uint8_t x0,uint8_t y0,uint8_t xl,uint8_t yl)
{
  uint8_t i,j;
  for(j=0;j<yl;j++)
  {
    for(i=0;i<xl;i++)
    {
      wr_lcd (MACRO_COMM,0x34);
      wr_lcd (MACRO_COMM,y0+j);
      wr_lcd (MACRO_COMM,x0+i);
      wr_lcd (MACRO_COMM,0x30);
      wr_lcd (MACRO_DAT,data1);
      wr_lcd (MACRO_DAT,data2);
    }
  }
  wr_lcd (MACRO_COMM,0x36);
}



/*
DDRAM地址
*/
static const uint8_t AC_TABLE[] = {
0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,
0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,
0x88,0x89,0x8a,0x8b,0x8c,0x8d,0x8e,0x8f,
0x98,0x99,0x9a,0x9b,0x9c,0x9d,0x9e,0x9f,
};


/*
@功能：任意位置显示字库文字
@参数：letter，待显示字符串；x 左右横坐标，0~8；y 上下纵坐标 0~3
@注意：一次最多显示一行
*/
void lcd_show_letter( char *letter, uint8_t x, uint8_t y)
{
	uint8_t cnt = 0;
  wr_lcd (MACRO_COMM, 0x30);
  wr_lcd (MACRO_COMM, AC_TABLE[8*y + x]);
	while(*letter != 0 && cnt < 2*(8 - x))
	{
		wr_lcd (MACRO_DAT, *letter);
		letter++;
		if((uint8_t)(*letter) < 128)
			cnt += 1;
		else
			cnt += 1;
	}
}


/*
@功能：显示二维码
@参数：x ,y 起始坐标；xlong 显示宽度 因为是方形，长宽相同；scale 放大系数；buf 点阵，一个字节表示一个点
@注意：暂时只能显示在上半屏
*/
void lcd_show_ercode(uint16_t x, uint16_t y, uint16_t xylong, uint8_t version , uint8_t buf[][61] ) 
{
	
	uint32_t i, j;
	uint8_t tmp_y[5], k;
	uint8_t width = xylong/8;
	uint8_t top_half, bottom_half;

	if(version > 10)
		return;
	
	if(xylong > top_half)
	{
		top_half = 32;
		bottom_half = xylong - 32;
	}
	else
	{
		top_half = xylong;
		bottom_half = 0;
	}

	wr_lcd(MACRO_COMM, 0x34);//关闭图形显示
	
	//上半屏显示
	for(i = 0;i < top_half; i++)//上半屏的0~31行
	{
		wr_lcd(MACRO_COMM,0x80 | i);	//i在这里表示半屏的0~31行(纵坐标)
		wr_lcd(MACRO_COMM,0x80 | x);	//这里0~7表示上半屏，8~15表示下半屏；这个是自增的(横坐标)
		delay_us(2);
		for(j = 0; j < width; j++)
		{
			for(k = 0, tmp_y[j] = 0; k < 8; k++)//8个点(8个字节)组成一个字节数据
			{
				tmp_y[j] |= buf[i][j*8 +k] << (7 - k);
			}
			wr_lcd(MACRO_DAT, ~tmp_y[j]);
			delay_us(1);
		}
		//画最右边的竖线（因为一次写入8bit，1Byte，所以41点阵有一个点没写；
		//注意这里写1个字节，右边一个字节内不能有显示内容，否则会覆盖）
		wr_lcd(MACRO_DAT, ~buf[i][40] << 7);
		delay_us(1);
	}
	
	//下半屏显示
	for(i = 0; i < bottom_half; i++)//下半屏的0~9行
	{
		wr_lcd(MACRO_COMM,0x80 | i);	//i在这里表示半屏的0~31行(纵坐标)
		wr_lcd(MACRO_COMM,0x80 | x+8);//这里0~7表示上半屏，8~15表示下半屏；这个是自增的(横坐标)
		for(j = 0; j < width; j++)
		{
			for(k = 0, tmp_y[j] = 0; k < 8; k++)//8个点(8个字节)组成一个字节数据
			{
				tmp_y[j] |= buf[i+32][j*8 +k] << (7 - k);
			}
			wr_lcd(MACRO_DAT, ~tmp_y[j]);
			delay_us(1);
		}
		//画最右边的竖线（因为一次写入8bit，1Byte，所以41点阵有一个点没写；
		//注意这里写1个字节，右边一个字节内不能有显示内容，否则会覆盖）
		wr_lcd(MACRO_DAT, ~buf[i+32][40] << 7);
		delay_us(1);
	}

	wr_lcd(MACRO_COMM,0x36);//开图形显示
}







/*
@功能：初始化 12864 引脚
*/
void _lcd_config(void)
{
	GPIO_SetMode(PB, BIT0, GPIO_MODE_OUTPUT);//CS
	GPIO_SetMode(PA, BIT6, GPIO_MODE_OUTPUT);//SID
	GPIO_SetMode(PB, BIT12, GPIO_MODE_OUTPUT);//RST
	GPIO_SetMode(PB, BIT14, GPIO_MODE_OUTPUT);//CLK
	
//	_RST = 0;
	_RST = 1;
//	_CS = 1;
  wr_lcd(MACRO_COMM, 0x30);  /*30---基本指令动作*/ 
  wr_lcd(MACRO_COMM, 0x01);  /*清屏，地址指针指向00H*/
	delay_us(1);
  wr_lcd(MACRO_COMM, 0x06);  /*光标的移动方向*/
  wr_lcd(MACRO_COMM, 0x0c);  /*开显示，关游标*/
	
	lcd_clear();
	lat_disp (0x00,0x00);
	
	{
//		uint32_t time;
//		time = xTaskGetTickCount();
//		delay_ms(200);
//		time = xTaskGetTickCount() - time;
//		time = time;
	}
}
